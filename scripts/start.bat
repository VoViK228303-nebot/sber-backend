@echo off
chcp 65001 >nul
echo ==========================================
echo ðŸ¦ Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ SBER
echo ==========================================
echo.

:: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Docker
docker --version >nul 2>&1
if errorlevel 1 (
    echo âŒ Docker Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Docker Desktop.
    exit /b 1
)

echo [1/5] ðŸ³ Ð—Ð°Ð¿ÑƒÑÐº Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²...
cd /d "%~dp0\.."
docker-compose up -d
if errorlevel 1 (
    echo âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
    exit /b 1
)
echo âœ… Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹

echo.
echo [2/5] â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…...
timeout /t 5 /nobreak >nul
echo âœ… Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð³Ð¾Ñ‚Ð¾Ð²Ð°

echo.
echo [3/5] ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹...
call npm install
if errorlevel 1 (
    echo âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    exit /b 1
)
echo âœ… Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹

echo.
echo [4/5] ðŸ”§ ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Prisma...
cd apps\api
call npx prisma migrate deploy
if errorlevel 1 (
    echo âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
    exit /b 1
)
echo âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ñ‹

echo.
echo [5/5] ðŸŒ± Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸...
call npx prisma db seed
if errorlevel 1 (
    echo âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸
    exit /b 1
)
echo âœ… Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹

echo.
echo ==========================================
echo ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ...
echo ==========================================
echo.
echo ðŸ“± Ð¤Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð½Ð°: http://localhost:5173
echo ðŸ”Œ API Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð½Ð°: http://localhost:3001
echo.
echo ðŸ§ª Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸:
echo    - Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: +79001234567, ÐŸÐ°Ñ€Ð¾Ð»ÑŒ: password123
echo    - Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: +79009876543, ÐŸÐ°Ñ€Ð¾Ð»ÑŒ: password123
echo.
echo âš ï¸  Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C Ð² Ð¾ÐºÐ½Ð°Ñ… Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ð¾Ð²
echo.

:: Ð—Ð°Ð¿ÑƒÑÐº Ð±ÑÐºÐµÐ½Ð´Ð° Ð¸ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð° Ð² Ð½Ð¾Ð²Ñ‹Ñ… Ð¾ÐºÐ½Ð°Ñ…
start "Backend API" cmd /k "cd /d "%~dp0\..\apps\api" && npm run dev"
timeout /t 3 /nobreak >nul
start "Frontend Web" cmd /k "cd /d "%~dp0\..\apps\web" && npm run dev"

echo âœ… ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾!
echo.
pause
